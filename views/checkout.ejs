<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Choose Payment Gateway</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">


  <!-- Razorpay & PayPal SDK -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script src="https://www.paypal.com/sdk/js?client-id=<%= process.env.PAYPAL_CLIENT_KEY %>&currency=USD"></script>

  <style>
    body {
      min-height: 100vh;
      /* display: flex; */
      justify-content: center;
      align-items: center;
    }
    .payment-card {
      max-width: 500px;
      width: 100%;
      border-radius: 20px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      background: #fff;
      padding: 2rem;
    }

    .payment-wrapper {
  display: flex;
  justify-content: center;  /* horizontal center */
  align-items: center;      /* vertical center */
  min-height: 80vh;         /* center relative to viewport height */
}

    .payment-card h2 {
      font-weight: 600;
      margin-bottom: 1.5rem;
      text-align: center;
    }
    .btn-custom {
      border-radius: 50px;
      font-size: 1rem;
      padding: 0.75rem 1.2rem;
      width: 100%;
      margin-bottom: 1rem;
      transition: 0.3s ease;
    }
    .btn-custom:hover {
      transform: translateY(-2px);
    }
    #paypal-button-container {
      margin-top: 1rem;
    }
  </style>
<link rel="stylesheet" href="/css/style.css"></link>  
</head>
<body>
<div class="payment-wrapper">
  <div class="payment-card">
    <% if (user.userType==="editor"){%>
      <h2>Pay $100 for 100 Blogs</h2>
    <%}else{%>
      <h2>Pay $5 for Pro Access</h2>
      <%}%>

    <!-- Stripe button -->
    <form action="/create-stripe-session" method="POST">
      <button type="submit" class="btn btn-dark btn-custom">ðŸ’³ Pay with Stripe</button>
    </form>

    <!-- Razorpay button -->
    <button id="rzp-button" class="btn btn-dark btn-custom">ðŸ’° Pay with Razorpay</button>
    <button id="phonepePay" class="btn btn-dark btn-custom">ðŸ’° Pay with PhonePe</button>

    <!-- PayPal button -->
    <div id="paypal-button-container"></div>

    <!-- <button id="phonepePay">Pay with PhonePe</button> -->

    <div class="text-center mt-3">
      <a href="/" class="text-decoration-none">â¬… Go back to Home</a>
    </div>
  </div>
</div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ============ Razorpay ============
    document.getElementById('rzp-button').onclick = async function (e) {
      e.preventDefault();

      const response = await fetch("/create-razorpay-order", { method: "POST" });
      const order = await response.json();

      const options = {
        key: "<%= process.env.RAZORPAY_KEY_ID %>",
        amount: order.amount,
        currency: order.currency,
        name: "Blog Upgrade",
        description: "Upgrade to premium plan to post more blogs",
        order_id: order.id,
        handler: async function (paymentResponse) {
          const verifyRes = await fetch("/razorpay-verify", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(paymentResponse)
          });

          if (verifyRes.ok) {
            window.location.href = "/payment-success?gateway=razorpay";
          } else {
            alert("Payment verification failed. Please try again.");
          }
        }
      };

      const rzp1 = new Razorpay(options);
      rzp1.open();
    };

    // ============ PayPal ============
   paypal.Buttons({
    createOrder: async () => {
      const res = await fetch("/create-paypal-order", { method: "POST" });
      if (!res.ok) throw new Error("Could not create PayPal order");
      const data = await res.json();
      return data.id;
    },
    onApprove: async (data) => {
      try {
        const res = await fetch("/capture-paypal-order", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ orderID: data.orderID })
        });

        const result = await res.json();

        if (result.status === "COMPLETED") {
          window.location.href = "/payment-success?gateway=paypal";
        } else {
          console.error("Order not completed:", result);
          window.location.href = "/cancel";
        }
      } catch (err) {
        console.error("Error capturing order:", err);
        window.location.href = "/cancel";
      }
    },
    onCancel: () => {
      window.location.href = "/cancel";
    },
    onError: (err) => {
      console.error("PayPal error:", err);
      window.location.href = "/cancel";
    }
  }).render("#paypal-button-container");

      // ============ PhonePe ============
  document.getElementById("phonepePay").addEventListener("click", async () => {
  const res = await fetch("/create-phonepe-order", { method: "POST" });
  const data = await res.json();
  if (data.url) {
    window.location.href = data.url;
  } else {
    alert("Error creating PhonePe order");
  }
  });
  </script>

</body>
</html>
